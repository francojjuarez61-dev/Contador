<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ARGENTINA2077 - ArgenCash</title>
  <meta name="theme-color" content="#050505" />

  <style>
    :root{
      --bg:#050505;
      --text:#fff;
      --muted: rgba(255,255,255,.65);

      --glass: rgba(25, 25, 30, 0.70);
      --stroke: rgba(255,255,255,.18);

      --cyan: #22d3ee;
      --purple: #a855f7;
      --red: #fb7185;
      --emerald: #34d399;
      --orange: #fb923c;

      --r-xl: 24px;
      --r-lg: 18px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.30);
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg);
      color: var(--text);
      overflow-x:hidden;
    }

    /* Fondo gradientes */
    .bg-layer{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    .blob{
      position:absolute;
      border-radius: 999px;
      filter: blur(80px);
      opacity: .45;
      animation: pulseSlow 8s ease-in-out infinite;
      transform: translate3d(0,0,0);
    }
    .blob.a{ width: 62vw; height: 62vw; top: -12%; left: -12%; background: rgba(88,28,135,.75); }
    .blob.b{ width: 74vw; height: 74vw; bottom: -14%; right: -14%; background: rgba(8,145,178,.70); animation-delay: 1.2s; }
    @keyframes pulseSlow{
      0%,100%{ transform: scale(1); opacity: .30; }
      50%{ transform: scale(1.08); opacity: .55; }
    }

    .app{
      position: relative;
      z-index: 1;
      max-width: 820px;
      margin: 0 auto;
      padding: 18px 14px 40px;
      padding-top: calc(14px + env(safe-area-inset-top));
      padding-bottom: calc(24px + env(safe-area-inset-bottom));
    }

    /* Header */
    header{
      text-align:center;
      margin: 10px 0 16px;
    }
    .brand{
      display:inline-block;
      position:relative;
    }
    .brand h1{
      margin:0;
      font-size: 34px;
      font-weight: 900;
      letter-spacing: -0.03em;
      text-shadow: 0 0 12px rgba(255,255,255,.25);
    }
    .brand h1 span{ color: var(--cyan); }
    .bar{
      height: 4px;
      width: 100%;
      margin-top: 8px;
      background: linear-gradient(90deg, transparent, rgba(34,211,238,.95), transparent);
      box-shadow: 0 0 12px rgba(34,211,238,.45);
      border-radius: 999px;
    }

    /* Glass panel */
    .glass{
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: var(--r-xl);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
    }

    /* Total */
    .total-card{
      padding: 18px;
      text-align:center;
      position:relative;
      overflow:hidden;
      margin-bottom: 14px;
    }
    .total-card::before{
      content:"";
      position:absolute;
      inset:-40px;
      background: radial-gradient(260px 180px at 25% 20%, rgba(34,211,238,.18), transparent 60%),
                  radial-gradient(260px 220px at 80% 0%, rgba(168,85,247,.16), transparent 60%);
      opacity: .9;
      pointer-events:none;
    }
    .total-card > *{ position:relative; z-index:1; }

    .label{
      color: rgba(34,211,238,.85);
      font-size: 12px;
      font-weight: 800;
      letter-spacing: .22em;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .total{
      font-size: clamp(42px, 10vw, 62px);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1.05;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 12px 32px rgba(0,0,0,.35);
    }

    .reset-link{
      margin-top: 10px;
      background: transparent;
      border: none;
      color: rgba(255,255,255,.62);
      font-size: 11px;
      font-weight: 900;
      letter-spacing: .12em;
      text-transform: uppercase;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      cursor:pointer;
    }
    .reset-link:hover{ color: rgba(251,113,133,.95); }

    /* Toggle */
    .toggle{
      width:100%;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.18);
      padding: 14px 14px;
      font-weight: 900;
      letter-spacing: .14em;
      text-transform: uppercase;
      cursor:pointer;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
      margin-bottom: 12px;
    }
    .toggle.cyan{
      background: rgba(8,145,178,.35);
      border-color: rgba(34,211,238,.55);
      color: rgba(207,250,254,.95);
      box-shadow: 0 0 18px rgba(34,211,238,.20);
    }
    .toggle.purple{
      background: rgba(88,28,135,.35);
      border-color: rgba(168,85,247,.55);
      color: rgba(243,232,255,.95);
      box-shadow: 0 0 18px rgba(168,85,247,.20);
    }
    .toggle:active{ transform: scale(.99); }

    /* Switch row (sonido / vibraciÃ³n) */
    .prefs{
      display:flex;
      gap: 10px;
      margin: 10px 0 4px;
      flex-wrap: wrap;
      justify-content:center;
    }
    .chip{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      font-size: 12px;
      font-weight: 900;
      color: rgba(255,255,255,.75);
      user-select:none;
      -webkit-user-select:none;
    }
    .switch{
      width: 46px;
      height: 26px;
      border-radius: 999px;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.18);
      position: relative;
      cursor:pointer;
      flex: none;
    }
    .knob{
      position:absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 3px;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: rgba(255,255,255,.85);
      transition: left .18s ease;
    }
    .switch.on{ background: rgba(34,211,238,.25); border-color: rgba(34,211,238,.35); }
    .switch.on .knob{ left: 23px; }

    /* Contador: lista */
    .list{
      display:grid;
      gap: 10px;
      padding-bottom: 22px;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 12px;
      border-radius: var(--r-lg);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(25,25,30,.62);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 12px 28px rgba(0,0,0,.28);
      transition: transform .12s ease, border-color .12s ease;
    }
    .row:active{ transform: scale(.995); }

    .left{
      flex:1;
      min-width:0;
    }
    .kicker{
      font-size: 10px;
      font-weight: 900;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: rgba(255,255,255,.45);
      margin-bottom: 2px;
    }
    .money{
      font-size: 22px;
      font-weight: 900;
      font-variant-numeric: tabular-nums;
      display:flex;
      align-items:baseline;
      gap: 6px;
      white-space: nowrap;
    }
    .money .sign{ font-size: 14px; color: rgba(34,211,238,.95); font-weight: 800; }
    .money .val{ overflow:hidden; text-overflow: ellipsis; }

    .controls{
      display:flex;
      align-items:center;
      gap: 8px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 6px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      flex: none;
    }
    .btn{
      width: 42px;
      height: 42px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      font-size: 22px;
      font-weight: 900;
      cursor:pointer;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .btn.minus:hover{ background: rgba(251,113,133,.22); border-color: rgba(251,113,133,.25); }
    .btn.plus:hover{ background: rgba(34,211,238,.20); border-color: rgba(34,211,238,.25); color: rgba(207,250,254,.95); }
    .btn:active{ transform: scale(.97); }

    .count{
      width: 54px;
      text-align:center;
      font-variant-numeric: tabular-nums;
      font-size: 18px;
      font-weight: 900;
      color: rgba(255,255,255,.95);
      user-select:none;
      -webkit-user-select:none;
    }

    /* Bordes por denominaciÃ³n */
    .b-20000{ border-color: rgba(34,211,238,.50); }
    .b-10000{ border-color: rgba(168,85,247,.50); }
    .b-2000{ border-color: rgba(251,146,60,.50); }
    .b-default{ border-color: rgba(255,255,255,.14); }

    /* Asistente */
    .assistant{
      display:grid;
      gap: 12px;
      padding-bottom: 22px;
    }
    .card{
      padding: 14px;
      border-radius: var(--r-lg);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(25,25,30,.62);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 12px 28px rgba(0,0,0,.28);
    }
    .card h3{
      margin:0 0 10px;
      font-size: 16px;
      font-weight: 900;
      letter-spacing: .04em;
      display:flex;
      align-items:center;
      gap: 8px;
      color: rgba(243,232,255,.95);
      border-bottom: 1px solid rgba(255,255,255,.10);
      padding-bottom: 10px;
    }
    .field{
      display:grid;
      gap: 8px;
      margin-top: 10px;
    }
    .field label{
      font-size: 11px;
      font-weight: 900;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(255,255,255,.68);
    }
    .input{
      width: 100%;
      height: 46px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.45);
      color: rgba(52,211,153,.95);
      font-weight: 900;
      font-size: 16px;
      padding: 0 12px 0 36px;
      outline: none;
      font-variant-numeric: tabular-nums;
    }
    .input:focus{
      border-color: rgba(52,211,153,.55);
      box-shadow: 0 0 0 2px rgba(52,211,153,.15);
    }
    .prefix{
      position: relative;
    }
    .prefix span{
      position:absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(52,211,153,.95);
      font-weight: 900;
    }

    .rangeRow{
      display:flex;
      gap: 10px;
      align-items:center;
    }
    input[type="range"]{
      flex:1;
      accent-color: var(--purple);
      height: 18px;
    }
    .pill{
      min-width: 90px;
      text-align:center;
      font-weight: 900;
      font-variant-numeric: tabular-nums;
      color: rgba(243,232,255,.95);
      background: rgba(168,85,247,.18);
      border: 1px solid rgba(168,85,247,.25);
      border-radius: 12px;
      padding: 10px 10px;
      font-size: 13px;
    }

    .results{
      border-top: 2px solid rgba(34,211,238,.75);
      background: rgba(17,24,39,.62);
      position:relative;
      overflow:hidden;
    }
    .results::before{
      content:"";
      position:absolute;
      right:-18px;
      top:-18px;
      width: 140px;
      height: 140px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      filter: blur(2px);
      pointer-events:none;
    }

    .row2{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap: 10px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      margin-bottom: 12px;
    }
    .row2 .t1{ font-size: 11px; color: rgba(255,255,255,.45); font-weight: 900; letter-spacing:.12em; text-transform: uppercase;}
    .row2 .v1{ font-size: 22px; font-weight: 900; font-variant-numeric: tabular-nums; }
    .row2 .v2{ font-size: 13px; font-weight: 900; color: rgba(52,211,153,.95); }

    .modeTitle{
      font-size: 20px;
      font-weight: 900;
      margin: 0 0 8px;
    }
    .quote{
      margin: 0 0 12px;
      font-size: 13px;
      color: rgba(255,255,255,.80);
      font-style: italic;
      background: rgba(255,255,255,.05);
      border-left: 2px solid rgba(255,255,255,.18);
      padding: 10px 10px;
      border-radius: 12px;
    }

    .breakdown{
      display:grid;
      gap: 10px;
    }
    .bitem{
      display:flex;
      gap: 10px;
      align-items:center;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 10px;
    }
    .icon{
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      color: rgba(34,211,238,.95);
      flex:none;
      font-weight: 900;
    }
    .bitem .lab{
      font-size: 11px;
      font-weight: 900;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(207,250,254,.92);
      margin-bottom: 2px;
    }
    .bitem .txt{
      font-size: 12px;
      color: rgba(255,255,255,.70);
      line-height: 1.25;
    }

    .footer{
      text-align:center;
      margin-top: 18px;
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,.06);
      color: rgba(255,255,255,.30);
      font-size: 10px;
      letter-spacing: .12em;
      text-transform: uppercase;
      font-weight: 900;
    }

    /* Mini iconos (emoji) */
    .ico{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="bg-layer">
    <div class="blob a"></div>
    <div class="blob b"></div>
  </div>

  <div class="app">
    <header>
      <div class="brand">
        <h1>ARGENTINA<span>2077</span></h1>
        <div class="bar"></div>
      </div>
    </header>

    <section class="glass total-card">
      <div class="label">Total Detectado</div>
      <div class="total" id="total">$0</div>

      <button class="reset-link" id="resetAllBtn">
        <span class="ico">âŸ²</span> Reiniciar Sistema
      </button>

      <div class="prefs">
        <div class="chip">
          <span class="ico">ðŸ”Š</span> Sonido
          <div class="switch" id="soundSwitch" role="switch" aria-checked="true">
            <div class="knob"></div>
          </div>
        </div>
        <div class="chip">
          <span class="ico">ðŸ“³</span> VibraciÃ³n
          <div class="switch" id="vibeSwitch" role="switch" aria-checked="true">
            <div class="knob"></div>
          </div>
        </div>
      </div>
    </section>

    <button class="toggle cyan" id="toggleBtn">
      <span class="ico">ðŸ§ </span>
      <span id="toggleText">ACTIVAR ASISTENTE IA</span>
    </button>

    <!-- CONTADOR -->
    <div class="list" id="counterView"></div>

    <!-- ASISTENTE -->
    <div class="assistant" id="assistantView" style="display:none;">
      <div class="card">
        <h3><span class="ico">ðŸ§ </span> CONFIGURACIÃ“N</h3>

        <div class="field">
          <label for="savingsInput">Monto a Separar (Ahorro)</label>
          <div class="prefix">
            <span>$</span>
            <input class="input" id="savingsInput" type="number" inputmode="numeric" placeholder="0" />
          </div>
        </div>

        <div class="field">
          <label for="daysRange">DÃ­as a cubrir</label>
          <div class="rangeRow">
            <input id="daysRange" type="range" min="1" max="31" value="7" />
            <div class="pill" id="daysPill">7 DÃ­as</div>
          </div>
        </div>
      </div>

      <div class="card results" id="resultsCard">
        <div class="row2">
          <div>
            <div class="t1">Presupuesto Diario</div>
            <div class="v1" id="dailyBudget">$0</div>
          </div>
          <div style="text-align:right;">
            <div class="t1">Disponible Real</div>
            <div class="v2" id="availableBudget">$0</div>
          </div>
        </div>

        <h4 class="modeTitle" id="modeTitle">Esperando fondos...</h4>
        <p class="quote" id="modeQuote">IngresÃ¡ tus billetes para comenzar el anÃ¡lisis.</p>

        <div class="breakdown" id="breakdown"></div>
      </div>
    </div>

    <div class="footer">SISTEMA DE GESTIÃ“N MONETARIA V.2.6</div>
  </div>

  <script>
    /* =========================
       STATE + STORAGE
    ========================= */
    const BILL_TYPES = [20000, 10000, 2000, 1000, 500, 200, 100];
    const STORAGE_KEY = "argencash2077_v1";

    const defaultState = () => {
      const counts = {};
      BILL_TYPES.forEach(v => counts[v] = 0);
      return {
        counts,
        showAssistant: false,
        savingsTarget: 0,
        daysToLast: 7,
        soundOn: true,
        vibeOn: true,
      };
    };

    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return defaultState();
      try{
        const data = JSON.parse(raw);
        const base = defaultState();

        // merge seguro
        if(data && typeof data === "object"){
          if(data.counts && typeof data.counts === "object"){
            for(const k of Object.keys(base.counts)){
              const v = Number(data.counts[k] ?? 0);
              base.counts[k] = Number.isFinite(v) ? Math.max(0, v) : 0;
            }
          }
          base.showAssistant = !!data.showAssistant;
          base.savingsTarget = Math.max(0, Number(data.savingsTarget || 0));
          base.daysToLast = Math.min(31, Math.max(1, Number(data.daysToLast || 7)));
          base.soundOn = data.soundOn !== false;
          base.vibeOn = data.vibeOn !== false;
        }
        return base;
      }catch{
        return defaultState();
      }
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let state = loadState();

    /* =========================
       FEEDBACK (click + vibrate)
    ========================= */
    let audioCtx = null;
    function clickSound(){
      if(!state.soundOn) return;
      try{
        const AC = window.AudioContext || window.webkitAudioContext;
        if(!AC) return;
        if(!audioCtx) audioCtx = new AC();

        const t = audioCtx.currentTime;
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();

        o.type = "square";
        o.frequency.setValueAtTime(950, t);

        g.gain.setValueAtTime(0.0001, t);
        g.gain.exponentialRampToValueAtTime(0.07, t + 0.005);
        g.gain.exponentialRampToValueAtTime(0.0001, t + 0.03);

        o.connect(g);
        g.connect(audioCtx.destination);

        o.start(t);
        o.stop(t + 0.035);
      }catch(e){}
    }
    function haptic(){
      if(!state.vibeOn) return;
      try{
        if(navigator.vibrate) navigator.vibrate(10);
      }catch(e){}
    }
    function feedback(){
      clickSound();
      haptic();
    }

    /* =========================
       UI REFS
    ========================= */
    const elTotal = document.getElementById("total");
    const counterView = document.getElementById("counterView");
    const assistantView = document.getElementById("assistantView");
    const toggleBtn = document.getElementById("toggleBtn");
    const toggleText = document.getElementById("toggleText");

    const savingsInput = document.getElementById("savingsInput");
    const daysRange = document.getElementById("daysRange");
    const daysPill = document.getElementById("daysPill");

    const elDailyBudget = document.getElementById("dailyBudget");
    const elAvailableBudget = document.getElementById("availableBudget");
    const elModeTitle = document.getElementById("modeTitle");
    const elModeQuote = document.getElementById("modeQuote");
    const elBreakdown = document.getElementById("breakdown");

    const resetAllBtn = document.getElementById("resetAllBtn");
    const soundSwitch = document.getElementById("soundSwitch");
    const vibeSwitch = document.getElementById("vibeSwitch");

    /* =========================
       FORMAT
    ========================= */
    function formatCurrency(value){
      return new Intl.NumberFormat("es-AR", { style:"currency", currency:"ARS", minimumFractionDigits:0 }).format(value);
    }

    function totalAmount(){
      let total = 0;
      for(const bill of BILL_TYPES){
        total += (state.counts[bill] || 0) * bill;
      }
      return total;
    }

    /* =========================
       ASSISTANT LOGIC
    ========================= */
    function getAdvice(total, availableBudget, dailyBudget){
      if(total === 0){
        return { title:"Esperando fondos...", color:"#ffffff", strategy:"IngresÃ¡ tus billetes para comenzar el anÃ¡lisis.", breakdown:null };
      }
      if(availableBudget <= 0){
        return { title:"Alerta CrÃ­tica", color:"#fb7185", strategy:"Tus ahorros superan o igualan tu efectivo. AjustÃ¡ el ahorro.", breakdown:null };
      }

      const dailyUSD = dailyBudget / 1200; // referencia simple

      if(dailyUSD < 5){
        return {
          title:"Modo Supervivencia",
          color:"#fb7185",
          strategy:"Prioridad: Hidratos y Legumbres.",
          breakdown:[
            { icon:"ðŸ", label:"Alimentos", text:"Fideos, arroz, papa. Compras mayoristas." },
            { icon:"âš¡", label:"Servicios", text:"MinimizÃ¡ consumo elÃ©ctrico." },
            { icon:"ðŸ›’", label:"Compras", text:"Solo marcas econÃ³micas." }
          ]
        };
      } else if(dailyUSD < 15){
        return {
          title:"EconomÃ­a Controlada",
          color:"#fb923c",
          strategy:"Equilibrio con restricciones.",
          breakdown:[
            { icon:"ðŸ¥—", label:"Alimentos", text:"Carnes blancas, verduras de estaciÃ³n." },
            { icon:"ðŸšŒ", label:"Transporte", text:"Transporte pÃºblico preferente." },
            { icon:"ðŸ·ï¸", label:"Stock", text:"Buscar ofertas 2x1." }
          ]
        };
      } else {
        return {
          title:"Estabilidad",
          color:"#34d399",
          strategy:"OptimizaciÃ³n inteligente.",
          breakdown:[
            { icon:"ðŸ¥©", label:"Alimentos", text:"Variedad permitida. Carnes rojas." },
            { icon:"ðŸ›¡ï¸", label:"Salud", text:"Fondo de emergencia o prepaga." },
            { icon:"ðŸ§ ", label:"InversiÃ³n", text:"Compra moneda fuerte con excedente." }
          ]
        };
      }
    }

    function renderAssistant(){
      const total = totalAmount();
      const savings = Math.max(0, Number(state.savingsTarget || 0));
      const days = Math.max(1, Number(state.daysToLast || 7));

      const available = Math.max(0, total - savings);
      const daily = available / days;

      elDailyBudget.textContent = formatCurrency(daily);
      elAvailableBudget.textContent = formatCurrency(available);

      const advice = getAdvice(total, available, daily);

      elModeTitle.textContent = advice.title;
      elModeTitle.style.color = advice.color || "#fff";
      elModeQuote.textContent = `"${advice.strategy}"`;

      elBreakdown.innerHTML = "";
      if(advice.breakdown && advice.breakdown.length){
        for(const item of advice.breakdown){
          const div = document.createElement("div");
          div.className = "bitem";
          div.innerHTML = `
            <div class="icon">${item.icon}</div>
            <div>
              <div class="lab">${item.label}</div>
              <div class="txt">${item.text}</div>
            </div>
          `;
          elBreakdown.appendChild(div);
        }
      }
    }

    /* =========================
       LONG PRESS BUTTONS
    ========================= */
    function attachLongPress(button, stepFn){
      let pressed = false;
      let startTimer = null;
      let loopTimer = null;
      let interval = 160;

      const clear = () => {
        pressed = false;
        if(startTimer) clearTimeout(startTimer);
        if(loopTimer) clearTimeout(loopTimer);
        startTimer = null;
        loopTimer = null;
        interval = 160;
      };

      const loop = () => {
        if(!pressed) return;
        stepFn();
        interval = Math.max(35, interval * 0.86);
        loopTimer = setTimeout(loop, interval);
      };

      const start = (e) => {
        // importantÃ­simo en iOS para evitar selecciÃ³n/zoom raro
        if(e && e.preventDefault) e.preventDefault();
        pressed = true;

        // step inmediato
        stepFn();

        // luego arranca loop
        startTimer = setTimeout(loop, 320);
      };

      button.addEventListener("touchstart", start, { passive:false });
      button.addEventListener("touchend", clear);
      button.addEventListener("touchcancel", clear);
      button.addEventListener("touchmove", clear);

      button.addEventListener("mousedown", start);
      button.addEventListener("mouseup", clear);
      button.addEventListener("mouseleave", clear);
    }

    /* =========================
       COUNTER RENDER
    ========================= */
    function borderClass(val){
      if(val >= 20000) return "b-20000";
      if(val >= 10000) return "b-10000";
      if(val >= 2000) return "b-2000";
      return "b-default";
    }

    function updateCount(bill, delta){
      const cur = Number(state.counts[bill] || 0);
      state.counts[bill] = Math.max(0, cur + delta);
      saveState();
      renderAll();
    }

    function renderCounter(){
      counterView.innerHTML = "";
      for(const bill of BILL_TYPES){
        const count = Number(state.counts[bill] || 0);

        const row = document.createElement("div");
        row.className = `row ${borderClass(bill)}`;

        row.innerHTML = `
          <div class="left">
            <div class="kicker">Billete</div>
            <div class="money">
              <span class="sign">$</span>
              <span class="val">${bill.toLocaleString("es-AR")}</span>
            </div>
          </div>

          <div class="controls">
            <button class="btn minus" aria-label="Restar">âˆ’</button>
            <div class="count">${count}</div>
            <button class="btn plus" aria-label="Sumar">+</button>
          </div>
        `;

        const minusBtn = row.querySelector(".minus");
        const plusBtn = row.querySelector(".plus");

        // click normal (un paso)
        minusBtn.addEventListener("click", () => { feedback(); updateCount(bill, -1); });
        plusBtn.addEventListener("click", () => { feedback(); updateCount(bill, +1); });

        // long press (rÃ¡faga)
        attachLongPress(minusBtn, () => { feedback(); updateCount(bill, -1); });
        attachLongPress(plusBtn, () => { feedback(); updateCount(bill, +1); });

        counterView.appendChild(row);
      }
    }

    /* =========================
       MAIN RENDER
    ========================= */
    function renderTotal(){
      elTotal.textContent = formatCurrency(totalAmount());
    }

    function renderView(){
      if(state.showAssistant){
        counterView.style.display = "none";
        assistantView.style.display = "grid";
        toggleBtn.classList.remove("cyan");
        toggleBtn.classList.add("purple");
        toggleText.textContent = "VOLVER AL CONTADOR";
        renderAssistant();
      } else {
        assistantView.style.display = "none";
        counterView.style.display = "grid";
        toggleBtn.classList.remove("purple");
        toggleBtn.classList.add("cyan");
        toggleText.textContent = "ACTIVAR ASISTENTE IA";
      }
    }

    function renderSwitches(){
      soundSwitch.classList.toggle("on", !!state.soundOn);
      vibeSwitch.classList.toggle("on", !!state.vibeOn);
      soundSwitch.setAttribute("aria-checked", String(!!state.soundOn));
      vibeSwitch.setAttribute("aria-checked", String(!!state.vibeOn));
    }

    function renderInputs(){
      // savings
      savingsInput.value = state.savingsTarget ? String(state.savingsTarget) : "";
      // days
      daysRange.value = String(state.daysToLast || 7);
      daysPill.textContent = `${state.daysToLast || 7} DÃ­as`;
    }

    function renderAll(){
      renderTotal();
      renderSwitches();
      renderInputs();
      renderView();
      renderCounter(); // lo dejamos siempre listo por si volvÃ©s
      if(state.showAssistant) renderAssistant();
    }

    /* =========================
       EVENTS
    ========================= */
    toggleBtn.addEventListener("click", () => {
      feedback();
      state.showAssistant = !state.showAssistant;
      saveState();
      renderAll();
    });

    resetAllBtn.addEventListener("click", () => {
      feedback();
      if(!confirm("Â¿Reiniciar todo? (Conteos, ahorro, dÃ­as y modo)")) return;
      state = (function(){
        const s = (function(){
          const base = {};
          BILL_TYPES.forEach(v => base[v] = 0);
          return {
            counts: base,
            showAssistant: false,
            savingsTarget: 0,
            daysToLast: 7,
            soundOn: true,
            vibeOn: true,
          };
        })();
        return s;
      })();
      saveState();
      renderAll();
    });

    soundSwitch.addEventListener("click", () => {
      state.soundOn = !state.soundOn;
      saveState();
      renderSwitches();
      // si lo prendÃ©s, probamos con un feedback leve
      if(state.soundOn){ clickSound(); }
    });

    vibeSwitch.addEventListener("click", () => {
      state.vibeOn = !state.vibeOn;
      saveState();
      renderSwitches();
      if(state.vibeOn){ haptic(); }
    });

    savingsInput.addEventListener("input", (e) => {
      const v = Number(e.target.value || 0);
      state.savingsTarget = Math.max(0, v);
      saveState();
      if(state.showAssistant) renderAssistant();
      renderTotal();
    });

    daysRange.addEventListener("input", (e) => {
      const v = Number(e.target.value || 7);
      state.daysToLast = Math.min(31, Math.max(1, v));
      daysPill.textContent = `${state.daysToLast} DÃ­as`;
      saveState();
      if(state.showAssistant) renderAssistant();
    });

    /* =========================
       INIT
    ========================= */
    renderAll();
  </script>
</body>
</html>
